<div class="pagecontent">
    <div>
        <h1 id="username"></h1>
        <div id="profilecontent"></div>
        <div id="bookings">Bookings</div>
    </div>
</div>

<script>
    var user;
    $(document).ready(function() {
        $.ajax({
            type: 'GET',
            url: 'rest/user/page',
            dataType: 'json',
            success: function (data) {
                getPage(data);
                console.log(data);
            },
            error: function (data) {
                getPage(data);
                console.log(data);
            }
        });
        $.ajax({
            type: 'GET',
            url: 'rest/user/bookings',
            dataType: 'json',
            success: function (data) {
                getBookings(data);
                console.log(data);
            },
            error: function (data) {
                console.log(data);
            }
        });
    });

    function getPage(data) {
        //console.log(data);
        //localStorage.setItem("data",JSON.stringify(data));
        if(data != null){
            buildPage(data);
        } else if(data.code == 0){
            $('#content').load(data.message);
        } else {
            //$('#content').load('error.html');
        }
    }

    function buildPage(data){
        $('#username').html(data.CustFirstName + " " + data.CustLastName);

    }

    function getBookings(data){
        console.log(data);
        //alert(data.length);
        for(var i = 0; i < data.length; i++) {
            buildBookings(i,data[i]);
        }
    }

    function buildBookings(i,booking) {
        var id = "booking" + i;
        $('#'+id).load('bookings.html');
        console.log(document);
        var bookingsHtml =
                "<div class='BookingId'><p>"+booking.BookingId+"</p></div>" +
                "<div>" +
                "<div class='vCenter-hFlexStart'>" +
                "<div class='BookingNo vCenter-hFlexStart'><p class='label'>Booking#:&nbsp;</p><p>"+booking.BookingNo+"</p></div>" +
                "<div class='BookingDate vCenter-hFlexStart'><p class='label'>Booking Date:&nbsp;</p><p>"+booking.BookingDate+"</p></div>" +
                "<div class='TravelerCount vCenter-hFlexStart'><p class='label'>Num Travelers:&nbsp;</p><p>"+booking.TravelerCount+"</p></div>" +
                "</div>" +
                "<div class='BookingDetails vCenter-hFlexStart'><p class='label'>Booking Details:&nbsp;</p></div>";
        for(var n = 0; n < booking.BookingDetails.length; n++) {
            var detail = booking.BookingDetails[n];
            bookingsHtml +=
                    "<div class='Detail'>" +
//                    "<div class='BookingDetailId'>"+detail.BookingDetailId+"</div>" +
                    "<div class='ItineraryNo vCenter-hFlexStart'><p class='label'>Itinerary No:&nbsp;</p><p>"+detail.ItineraryNo+"</p></div>" +
                    "<div class='vCenter-hFlexStart'>" +
                    "<div class='TripStart vCenter-hFlexStart'><p class='label'>Trip Start:&nbsp;</p><p>"+detail.TripStart+"</p></div>" +
                    "<div class='TripEnd vCenter-hFlexStart'><p class='label'>Trip End:&nbsp;</p><p>"+detail.TripEnd+"</p></div>" +
                    "</div>" +
                    "<div class='vCenter-hFlexStart'>" +
                    "<div class='Description'><p class='label'>Description:&nbsp;</p><p>"+detail.Description+"</p></div>" +
                    "<div class='Destination'><p class='label'>Destination:&nbsp;</p><p>"+detail.Destination+"</p></div>" +
                    "</div>" +
                    "<div class='BasePrice vCenter-hFlexStart'><p class='label'>BasePrice:&nbsp;</p><p>$"+detail.BasePrice+".00</p></div>" +
                    "</div>";
        }
        bookingsHtml += "</div>";
        $('#bookings').append("<div id='"+id+"' class='vCenter-hFlexStart material'>"+bookingsHtml+"</div>");
    }
</script>